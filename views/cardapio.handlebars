<h1 class="mb-4 text-danger">Monte sua Pizza</h1>

<form id="pizzaForm" method="POST" action="/pedido">
  <!-- Sabores -->
  <div class="mb-4">
    <h4>Sabores (at√© 2)</h4>
    <div class="form-check">
      <input class="form-check-input sabor" type="checkbox" value="Calabresa" data-preco="5" id="sabor1">
      <label class="form-check-label" for="sabor1">Calabresa (+R$5,00)</label>
    </div>
    <div class="form-check">
      <input class="form-check-input sabor" type="checkbox" value="Portuguesa" data-preco="6" id="sabor2">
      <label class="form-check-label" for="sabor2">Portuguesa (+R$6,00)</label>
    </div>
    <div class="form-check">
      <input class="form-check-input sabor" type="checkbox" value="Frango c/ Catupiry" data-preco="7" id="sabor3">
      <label class="form-check-label" for="sabor3">Frango c/ Catupiry (+R$7,00)</label>
    </div>
    <div class="form-check">
      <input class="form-check-input sabor" type="checkbox" value="Marguerita" data-preco="5" id="sabor4">
      <label class="form-check-label" for="sabor4">Marguerita (+R$5,00)</label>
    </div>
    <div class="form-check">
      <input class="form-check-input sabor" type="checkbox" value="Quatro Queijos" data-preco="8" id="sabor5">
      <label class="form-check-label" for="sabor5">Quatro Queijos (+R$8,00)</label>
    </div>
  </div>

  <!-- Tamanhos -->
  <div class="mb-4">
    <h4>Tamanho</h4>
    <div class="form-check">
      <input class="form-check-input tamanho" type="radio" name="tamanho" value="Pequena" data-preco="25" id="tam1">
      <label class="form-check-label" for="tam1">Pequena (R$25,00)</label>
    </div>
    <div class="form-check">
      <input class="form-check-input tamanho" type="radio" name="tamanho" value="M√©dia" data-preco="35" id="tam2">
      <label class="form-check-label" for="tam2">M√©dia (R$35,00)</label>
    </div>
    <div class="form-check">
      <input class="form-check-input tamanho" type="radio" name="tamanho" value="Grande" data-preco="45" id="tam3">
      <label class="form-check-label" for="tam3">Grande (R$45,00)</label>
    </div>
  </div>

  <!-- Borda -->
  <div class="mb-4">
    <h4>Borda Recheada</h4>
    <div class="form-check">
      <input class="form-check-input borda" type="radio" name="borda" value="Catupiry" data-preco="5" id="borda1">
      <label class="form-check-label" for="borda1">Catupiry (+R$5,00)</label>
    </div>
    <div class="form-check">
      <input class="form-check-input borda" type="radio" name="borda" value="Cheddar" data-preco="5" id="borda2">
      <label class="form-check-label" for="borda2">Cheddar (+R$5,00)</label>
    </div>
    <div class="form-check">
      <input class="form-check-input borda" type="radio" name="borda" value="Chocolate" data-preco="6" id="borda3">
      <label class="form-check-label" for="borda3">Chocolate (+R$6,00)</label>
    </div>
    <div class="form-check">
      <input class="form-check-input borda" type="radio" name="borda" value="Sem Borda" data-preco="0" id="borda4" checked>
      <label class="form-check-label" for="borda4">Sem Borda (+R$0,00)</label>
    </div>
  </div>

  <!-- Adicionais -->
  <div class="mb-4">
    <h4>Adicionais</h4>
    <div class="form-check">
      <input class="form-check-input adicional" type="checkbox" value="Azeitona" data-preco="2" id="add1">
      <label class="form-check-label" for="add1">Azeitona (+R$2,00)</label>
    </div>
    <div class="form-check">
      <input class="form-check-input adicional" type="checkbox" value="Or√©gano Extra" data-preco="1" id="add2">
      <label class="form-check-label" for="add2">Or√©gano Extra (+R$1,00)</label>
    </div>
    <div class="form-check">
      <input class="form-check-input adicional" type="checkbox" value="Bacon" data-preco="3" id="add3">
      <label class="form-check-label" for="add3">Bacon (+R$3,00)</label>
    </div>
  </div>

  <!-- Valor total e bot√µes -->
  <div class="mb-4">
    <h4>Total: <span class="text-success" id="total">R$0,00</span></h4>
    
    <!-- Card promocional para bebidas -->
    <div class="card border-info mb-3" style="max-width: 500px; margin: 20px auto;">
      <div class="card-body text-center">
        <h6 class="card-title text-info">ü•§ Complete seu pedido!</h6>
        <p class="card-text small">Que tal uma bebida gelada para acompanhar?</p>
      </div>
    </div>
    
    <!-- Bot√µes de a√ß√£o -->
    <div class="d-flex gap-2 justify-content-center flex-wrap">
      <button type="submit" class="btn btn-primary btn-lg">
        <i class="fas fa-eye"></i> Ver Resumo da Pizza
      </button>
      <button type="button" class="btn btn-info btn-lg" id="irParaBebidas">
        <i class="fas fa-plus"></i> Pizza + Bebidas
      </button>
    </div>
    
    <div class="text-center mt-2">
      <small class="text-muted">Ou escolha "Ver Resumo" para finalizar apenas com pizza</small>
    </div>
  </div>
</form>

<!-- Estilos adicionais -->
<style>
.gap-2 {
  gap: 0.5rem;
}

.card.border-info {
  border-width: 2px;
  background: linear-gradient(135deg, #e3f2fd 0%, #f0f8ff 100%);
}

@media (max-width: 768px) {
  .d-flex.flex-wrap button {
    flex: 1;
    min-width: 200px;
    margin-bottom: 10px;
  }
}

.btn {
  transition: all 0.3s ease;
}

.btn:hover {
  transform: translateY(-2px);
}
</style>

<!-- Script para calcular total e integra√ß√£o com bebidas -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('pizzaForm');
    const totalEl = document.getElementById('total');
    const btnBebidas = document.getElementById('irParaBebidas');

    function calcularTotal() {
      let total = 0;

      // Sabores (at√© 2)
      const sabores = document.querySelectorAll('.sabor:checked');
      if (sabores.length > 2) {
        alert("Voc√™ pode escolher no m√°ximo 2 sabores.");
        sabores[sabores.length - 1].checked = false;
        return;
      }
      sabores.forEach(s => total += Number(s.dataset.preco));

      // Tamanho
      const tamanho = document.querySelector('.tamanho:checked');
      if (tamanho) total += Number(tamanho.dataset.preco);

      // Borda
      const borda = document.querySelector('.borda:checked');
      if (borda) total += Number(borda.dataset.preco);

      // Adicionais
      document.querySelectorAll('.adicional:checked').forEach(add => {
        total += Number(add.dataset.preco);
      });

      totalEl.textContent = `R$ ${total.toFixed(2)}`;
      return total.toFixed(2);
    }

    function validarPizza() {
      const sabores = document.querySelectorAll('.sabor:checked');
      const tamanho = document.querySelector('.tamanho:checked');
      
      if (sabores.length === 0) {
        alert("‚ö†Ô∏è Por favor, selecione pelo menos um sabor para a pizza!");
        return false;
      }
      
      if (!tamanho) {
        alert("‚ö†Ô∏è Por favor, selecione um tamanho para a pizza!");
        return false;
      }
      
      return true;
    }

    function coletarDadosPizza() {
      const dados = {
        sabores: [],
        tamanho: '',
        borda: '',
        adicionais: [],
        total: calcularTotal()
      };

      // Coletar sabores
      document.querySelectorAll('.sabor:checked').forEach(s => {
        dados.sabores.push(s.value);
      });

      // Coletar tamanho
      const tamanho = document.querySelector('.tamanho:checked');
      if (tamanho) dados.tamanho = tamanho.value;

      // Coletar borda
      const borda = document.querySelector('.borda:checked');
      if (borda) dados.borda = borda.value;

      // Coletar adicionais
      document.querySelectorAll('.adicional:checked').forEach(a => {
        dados.adicionais.push(a.value);
      });

      return dados;
    }

    // Event listener para recalcular total
    form.addEventListener('change', calcularTotal);

    // Event listener para ir direto √†s bebidas
    btnBebidas.addEventListener('click', (e) => {
      e.preventDefault();
      
      if (!validarPizza()) {
        return;
      }

      // Salvar dados da pizza no localStorage
      const dadosPizza = coletarDadosPizza();
      localStorage.setItem('dadosPizza', JSON.stringify(dadosPizza));

      // Redirecionar para bebidas
      window.location.href = '/bebidas';
    });

    // Event listener para o submit normal (ver resumo da pizza)
    form.addEventListener('submit', (e) => {
      if (!validarPizza()) {
        e.preventDefault();
        return;
      }

      const total = calcularTotal();

      // Remove campos ocultos antigos
      form.querySelectorAll('input[type="hidden"]').forEach(el => el.remove());

      // Criar inputs ocultos
      const appendHidden = (name, value) => {
        const input = document.createElement('input');
        input.type = 'hidden';
        input.name = name;
        input.value = value;
        form.appendChild(input);
      };

      document.querySelectorAll('.sabor:checked').forEach(s => {
        appendHidden('sabores[]', s.value);
      });

      const tamanho = document.querySelector('.tamanho:checked');
      if (tamanho) appendHidden('tamanho', tamanho.value);

      const borda = document.querySelector('.borda:checked');
      if (borda) appendHidden('borda', borda.value);

      document.querySelectorAll('.adicional:checked').forEach(a => {
        appendHidden('adicionais[]', a.value);
      });

      appendHidden('total', total);
    });

    // Calcular total inicial
    calcularTotal();
  });
</script>